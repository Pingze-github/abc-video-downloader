## TODO

+ 断点续传。服务器支持range参数，可以实现。还需要文件来记录总长度和已经下载长度。
+ 音视频合并。使用ffmpeg
+ 进度显示。
+ 卡主的时候，自动重试
+ 边下载边写入磁盘，不存于内存
+ 获取资源时，偶发性报错

```
ffmpeg -i video.mp4 -i audio.mp4 -c copy output.mp4
```

问题分析：
出现ParseError时，req仍可以收到完整的数据，但stream.finish无法触发。
测试确认，req.end时，已经完整获取数据，但stream流失败，文件为空。

猜测问题在于，req出错后，不能正常向文件stream写入。
请求直接返回302，无response。这会产生错误。

似乎只在音频中出现。

可以手动将数据写入文件。

* 有时候会无法触发res.end事件，流程会卡主。

问题属于随机事件，概率还挺高的。

但通过proxy时，就不会出问题？ 猜测是代理层对返回稍作了处理。比如302但相应非空。

可以尝试用原生http做尝试。


# 断点重连？？？